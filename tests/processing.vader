Execute (Output is only processed in normal/insert mode (loclist)):
  if !NeomakeAsyncTestsSetup() | finish | endif

  call neomake#Make(1, [neomake_test_sleep_efm_maker])
  norm! V
  NeomakeTestsWaitForFinishedJobs
  AssertEqual getloclist(0), [], 'Location list has not been updated'
  AssertNeomakeMessage 'sleep_efm_maker: completed with exit code 0.'
  AssertEqual mode(), 'V'
  exe "norm! \<Esc>"
  AssertEqual mode(), 'n'
  doautocmd CursorHold
  AssertNeomakeMessage 'sleep_efm_maker: processing 2 lines of output.'
  AssertEqual map(copy(getloclist(0)), 'v:val.text'), ['error message', 'warning']

Execute (Output is only processed in normal/insert mode (qflist)):
  if !NeomakeAsyncTestsSetup() | finish | endif

  call neomake#Make(0, [neomake_test_sleep_efm_maker])
  norm! V
  NeomakeTestsWaitForFinishedJobs
  AssertEqual getqflist(), [], 'Quickfix list has not been updated'
  AssertNeomakeMessage 'sleep_efm_maker: completed with exit code 0.'
  AssertEqual mode(), 'V'
  exe "norm! \<Esc>"
  AssertEqual mode(), 'n'
  doautocmd CursorHold
  AssertNeomakeMessage 'sleep_efm_maker: processing 2 lines of output.'
  AssertEqual map(copy(getqflist()), 'v:val.text'), ['error message', 'warning']

Execute (Output is only processed in normal/insert mode (from loclist)):
  if !NeomakeAsyncTestsSetup() | finish | endif

  call neomake#Make(1, [neomake_test_sleep_efm_maker])
  lopen
  AssertEqual &buftype, 'quickfix'
  AssertEqual winnr(), 2
  AssertEqual line('$'), 1
  norm! V
  NeomakeTestsWaitForFinishedJobs
  AssertEqual getloclist(0), [], 'Location list has not been updated'
  AssertNeomakeMessage 'sleep_efm_maker: completed with exit code 0.'
  AssertEqual mode(), 'V'
  exe "norm! \<Esc>"
  AssertEqual mode(), 'n'
  doautocmd CursorHold
  AssertEqual getloclist(0), []
  wincmd p
  AssertNeomakeMessage 'sleep_efm_maker: processing 2 lines of output.'
  AssertEqual map(copy(getloclist(0)), 'v:val.text'), ['error message', 'warning']

Execute (Output gets not processed from loclist):
  if !NeomakeAsyncTestsSetup() | finish | endif

  laddexpr ''
  call neomake#Make(1, [neomake_test_sleep_efm_maker])
  lopen
  AssertEqual &buftype, 'quickfix'
  AssertEqual winnr(), 2
  NeomakeTestsWaitForFinishedJobs
  AssertEqual winnr(), 2

  AssertEqual len(g:neomake_test_finished), 1
  AssertEqual getloclist(0), []

  lclose
  AssertEqual map(copy(getloclist(0)), 'v:val.text'), ['error message', 'warning']
